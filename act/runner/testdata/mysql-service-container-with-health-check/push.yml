name: service-container
on: push
jobs:
  service-container-test:
    runs-on: ubuntu-latest
    container: code.forgejo.org/oci/mysql:8.4
    services:
      maindb:
        image: code.forgejo.org/oci/mysql:8.4
        env:
          MYSQL_DATABASE: dbname
          MYSQL_USER: dbuser
          MYSQL_PASSWORD: dbpass
          MYSQL_RANDOM_ROOT_PASSWORD: yes
        options: --health-cmd="mysqladmin ping" --health-interval=10s --health-timeout=5s --health-retries=3
    steps:
    - run: mysql -u dbuser -D dbname -pdbpass -h maindb -e "create table T(id INT NOT NULL AUTO_INCREMENT, val VARCHAR(255), PRIMARY KEY (id))"
